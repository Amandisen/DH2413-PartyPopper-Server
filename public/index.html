<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href="#" />
    <link rel="stylesheet" type="text/css" href="/utils/style.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Nunito"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/ico" href="/images/favicon.ico">
    <script src="../utils/slide.js" defer></script>
    <title>Party Popper!</title>
  </head>

  <body>
    <p class="about__link" onclick="location.href='../about'">About</p>
    <img src="../images/logo.png" class="logo-img" />
    <div class="balloon-container" data-carousel="">
      <button
        id="color-button"
        class="carousel-button prev"
        data-carousel-button="prev"
      >
        <img src="./images/arrow.png" class="arrow-left" />
      </button>
      <section aria-label="Balloon composition">
        <div class="carousel" data-carousel>
          <ul data-slides>
            <li class="slide" data-active>
              <img id="color" src="./images/balloonpink.png" alt="pink" />
            </li>
            <li class="slide">
              <img id="color" src="./images/balloonblue.png" alt="blue" />
            </li>
            <li class="slide">
              <img id="color" src="./images/balloongreen.png" alt="green" />
            </li>
            <li class="slide">
              <img id="color" src="./images/balloonred.png" alt="red" />
            </li>
          </ul>
        </div>
      </section>
      <button
        id="color-button"
        class="carousel-button next"
        data-carousel-button="next"
      >
        <img src="./images/arrow.png" class="arrow-right" />
      </button>
      <div class="text-container">
        <h1>Choose color</h1>
        <p>Get the party started! How do you want your balloon to look?</p>
      </div>
    </div>
    <div class="balloon-container" data-carousel="">
      <button
        id="effect-button"
        class="carousel-button prev"
        data-carousel-button="prev"
      >
        <img src="./images/arrow.png" class="arrow-left" />
      </button>
      <section aria-label="Balloon composition">
        <div class="carousel" data-carousel>
          <ul data-slides>
            <li class="slide" data-active>
              <img id="effect" src="./images/waterdrop.png" alt="water" />
            </li>
            <li class="slide">
              <img id="effect" src="./images/confetti.png" alt="confetti" />
            </li>
            <li class="slide">
              <img id="effect" src="./images/marbles.png" alt="marbles" />
            </li>
            <li class="slide">
              <img id="effect" src="./images/splat.png" alt="paint" />
            </li>
            <li class="slide">
              <img id="effect" src="./images/disco.png" alt="disco" />
            </li>
            <li class="slide">
              <img id="effect" src="./images/deathstar.png" alt="deathstar" />
            </li>
          </ul>
        </div>
      </section>
      <button
        id="effect-button"
        class="carousel-button next"
        data-carousel-button="next"
      >
        <img src="./images/arrow.png" class="arrow-right" />
      </button>
      <div class="text-container">
        <h1>Choose effect</h1>
        <p>How are we gonna trash this party... You decide!</p>
      </div>
    </div>
    <!-- <div class="balloon-container" data-carousel="">
      <button
        id="music-button"
        class="carousel-button prev"
        data-carousel-button="prev"
      >
        <img src="./images/arrow.png" class="arrow-left" />
      </button>
      <section aria-label="Balloon composition">
        <div class="carousel" data-carousel>
          <ul data-slides>
            <li class="slide" data-active>
              <img id="music" src="./images/playbtn.png" alt="music" />
            </li>
            <li class="slide" data-active>
              <img id="music" src="./images/playbtn.png" alt="music" />
            </li>
          </ul>
        </div>
      </section> -->
    <!-- <button
        id="music-button"
        class="carousel-button next"
        data-carousel-button="next"
      >
        <img src="./images/arrow.png" class="arrow-right" />
      </button>
      <div class="text-container">
        <h1>Choose music</h1>
        <p>Mm the sweet sound of a party popping...</p>
      </div> -->
    <div class="balloon-btn-container">
      <button id="balloonButton" type="button" class="balloon-btn">
        Send balloon
      </button>
      <img src="./images/balloonInflation1.gif" id="balloonInflation" class="balloon-btn-inflation"/>
    </div>

    <script>
      const colorbuttons = document.querySelectorAll("#color-button");
      const effectbuttons = document.querySelectorAll("#effect-button");
      const musicbuttons = document.querySelectorAll("#music-button");
      const balloon = ["pink", "water", "music"];

      // color balloon
      colorbuttons.forEach((button) => {
        button.addEventListener("click", () => {
          const offset = button.dataset.carouselButton === "next" ? 1 : -1;
          const slides = button
            .closest("[data-carousel]")
            .querySelector("[data-slides]");

          const activeSlide = slides.querySelector("[data-active]");

          let newIndex = [...slides.children].indexOf(activeSlide) + offset;
          if (newIndex < 0) newIndex = slides.children.length - 1;
          if (newIndex >= slides.children.length) newIndex = 0;

          slides.children[newIndex].dataset.active = true;
          delete activeSlide.dataset.active;
          const colorBalloon =
            slides.children[newIndex].querySelectorAll("#color")[0].alt;

          balloon[0] = colorBalloon;
          //console.log(balloon);
        });
      });
      // effect balloon
      effectbuttons.forEach((button) => {
        button.addEventListener("click", () => {
          const offset = button.dataset.carouselButton === "next" ? 1 : -1;
          const slides = button
            .closest("[data-carousel]")
            .querySelector("[data-slides]");

          const activeSlide = slides.querySelector("[data-active]");

          let newIndex = [...slides.children].indexOf(activeSlide) + offset;
          if (newIndex < 0) newIndex = slides.children.length - 1;
          if (newIndex >= slides.children.length) newIndex = 0;

          slides.children[newIndex].dataset.active = true;
          delete activeSlide.dataset.active;
          const effectBalloon =
            slides.children[newIndex].querySelectorAll("#effect")[0].alt;

          balloon[1] = effectBalloon;
          //console.log(balloon);
        });
      });
      musicbuttons.forEach((button) => {
        button.addEventListener("click", () => {
          const offset = button.dataset.carouselButton === "next" ? 1 : -1;
          const slides = button
            .closest("[data-carousel]")
            .querySelector("[data-slides]");

          const activeSlide = slides.querySelector("[data-active]");

          let newIndex = [...slides.children].indexOf(activeSlide) + offset;
          if (newIndex < 0) newIndex = slides.children.length - 1;
          if (newIndex >= slides.children.length) newIndex = 0;

          slides.children[newIndex].dataset.active = true;
          delete activeSlide.dataset.active;
          const musicBalloon =
            slides.children[newIndex].querySelectorAll("#music")[0].alt;

          balloon[2] = musicBalloon;
          //console.log(balloon);
        });
      });

      // ws connection
      let wsClient;
      const balloonButton = document.querySelector("#balloonButton");
      const balloonInflation = document.querySelector("#balloonInflation");
      function sendMessageToServer(message) {
        if (!wsClient) {
          console.log("No websocket connection");
          return;
        } else {
          console.log(message);
          wsClient.send(message);
        }
      }

      balloonButton.onclick = function (event) {
        event.preventDefault();

        if (!wsClient) {
          console.log("No websocket connection");
          return;
        } else {
          console.log("Trying to send message from server:");

          const setBalloon = balloon.toString();
          balloonInflation.style.display = "block";
          balloonButton.style.display = "none";

          sendMessageToServer(setBalloon);
          
          setTimeout(function() {
            balloonInflation.style.display = "none";
            balloonButton.style.display = "block";
          }, 2000);
        }
      };

      function init() {
        let HOST = location.origin.replace(/^http/, "ws");
        wsClient = new WebSocket(HOST);

        wsClient.onopen = (event) => {
          console.log("Websocket connection established");
        };

        wsClient.onmessage = (event) => {
          console.log("Message received from server: ", event);
        };

        wsClient.onclose = (event) => {
          console.log("No WebSocket connection");
          wsClient = null;
        };

        wsClient.onerror = (event) => {
          console.error("WebSocket error observed:", event);
          wsClient = null;
        };
      }

      init();
    </script>
  </body>
</html>

<!-- FUNKAR
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script src="/utils/constants.js"></script>
    <link rel="shortcut icon" href="#">
    <title>Party Popper!</title>
</head>

<body>
    <h1>Click button to spawn balloon</h1>
    <button id="balloonButton" type="button">Balloons!!!</button>

    <script>
        var HOST = location.origin.replace(/^http/, 'ws')
        var ws = new WebSocket(HOST);
        const balloonButton = document.querySelector('#balloonButton');

        balloonButton.onclick = function (event) {
            e.preventDefault();

            if(!ws) {
                console.log('No websocket connection');
                return;
            } else {
                console.log("Trying to send message from server");
                sendMessageToServer("Balloon");
            }
        }



        let wsClient;
        var createBalloon = false;

        function sendMessageToServer(message) {
            if(!wsClient) {
                console.log('No websocket connection');
                return;
            } else {
                console.log(message);
                wsClient.send(message);
            }
        }


        balloonButton.onclick = function(e) {
            e.preventDefault();

            createBalloon = true;
            sendMessageToServer("Balloon");

        }

        function init() {
            const URL = 'ws://localhost:' + PORT;
            console.log(PORT);
            //var host = location.origin.replace(/^http/, 'ws');
            wsClient = new WebSocket(URL);

            //const wsClient = new WebSocket("wss://partypoppervr.herokuapp.com/")

            wsClient.onopen = (event) => {
                console.log('Websocket connection established');
            }

            wsClient.onmessage = (event) => {
                console.log('Message received from server: ', event);
            }

            wsClient.onclose = (event) => {
                console.log('No WebSocket connection');
                wsClient = null;
            }

            wsClient.onerror = (event) => {
                console.error("WebSocket error observed:", event);
                wsClient = null;
            }

            
        }
    
        init();

    </script>
</body>

</html> -->
